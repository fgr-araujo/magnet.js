<html>
  <head>
    <script src="./magnet.min.js"></script>
    <style>
      body {
        margin: 0;
      }
      #canvas {
        position: fixed;
        top: 0;
        right: 0;
        bottom: 0;
        left: 0;
        z-index: 1;
      }
      #x, #y {
        --size: 1px;

        position: fixed;
        top: calc(-1 * var(--size));
        left: calc(-1 * var(--size));
        background-color: #000;
        opacity: .25;
        pointer-events: none;
        z-index: 100;
      }
      #x {
        transform: translateY(-50%);
        height: var(--size);
        right: 0;
      }
      #y {
        transform: translateX(-50%);
        width: var(--size);
        bottom: 0;
      }
      #blank {
        height: 500%;
      }
      magnet-block {
        position: sticky;
        display: inline-block;
      }
    </style>
  </head>
  <body>
    <div id="canvas">
      <magnet-block
        style="width:100px; height:150px; background:#fcc;"
        group="a"
        attractDistance="15"
        alignTo=""
      >
        Hi
      </magnet-block>
      <magnet-block
        style="width:150px; height:100px; background:#cfc;"
        group="a"
        attractDistance="15"
        alignTo="outer|inner|center"
        alignToParent="center|inner"
        crossPrevent="parent|target"
      >
        Yo
      </magnet-block>
    </div>

    <div id="x"></div>
    <div id="y"></div>

    <div id="blank"></div>
  </body>
  <script>
    (function() {
      const domX = document.getElementById('x');
      const domY = document.getElementById('y');

      function onMagnetEnd() {
        domX.style.top = '';
        domY.style.left = '';
      }
      function onAttractOrAlignChange(event) {
        const {
          detail: {
            nextStep: {
              rectangle: nextRect,
            },
            min: {
              x: {
                alignment: alignmentX,
              },
              y: {
                alignment: alignmentY,
              },
            },
          },
        } = event;

        let posX, posY;

        switch (alignmentX) {
          case Magnet.ALIGNMENT.rightToRight:
          case Magnet.ALIGNMENT.rightToLeft:
            posX = nextRect.right;
            break;

          case Magnet.ALIGNMENT.leftToRight:
          case Magnet.ALIGNMENT.leftToLeft:
            posX = nextRect.left;
            break;

          case Magnet.ALIGNMENT.xCenterToXCenter:
            posX = .5 * (nextRect.right + nextRect.left);
            break;
        }
        switch (alignmentY) {
          case Magnet.ALIGNMENT.topToTop:
          case Magnet.ALIGNMENT.topToBottom:
            posY = nextRect.top;
            break;

          case Magnet.ALIGNMENT.bottomToTop:
          case Magnet.ALIGNMENT.bottomToBottom:
            posY = nextRect.bottom;
            break;

          case Magnet.ALIGNMENT.yCenterToYCenter:
            posY = .5 * (nextRect.top + nextRect.bottom);
            break;
        }
        domX.style.top = isNaN(posY) ?'' :`${posY}px`;
        domY.style.left = isNaN(posX) ?'' :`${posX}px`;
      }

      Array
        .from(document.querySelectorAll('magnet-block'))
        .forEach(function(dom) {
          dom.addEventListener('magnetend', onMagnetEnd);
          dom.addEventListener('magnetunattract', onAttractOrAlignChange);
          dom.addEventListener('magnetattract', onAttractOrAlignChange);
        });
    })();
  </script>
</html>